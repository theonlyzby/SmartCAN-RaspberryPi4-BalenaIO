<!-- BEGIN: main -->
<html>
  <head>
    <title>SmartCAN - Smart Domotica</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000"/>	
    <meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=5.0, minimum-scale=0.2">
    <meta http-equiv="content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
	<!-- meta name=viewport content="width=device-width, initial-scale=1" -->
	<!-- Phone layout? meta name=viewport content="width=800" -->
	
	<!-- WebApp Declarations -->
	<link rel="manifest" href="/smartcan/www/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes"> 
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	
	<!-- Icons -->
	<!-- All Browser ico=32*32, png=72*72 -->
	<link rel="icon" href="./images/icons/favicon.ico" type="image/x-icon"/>
	<link rel="icon" href="./images/icons/favicon.png" type="image/x-icon"/>
	<!-- Android -->
	<link href="./images/icons/icon-196x196.png"                          rel="shortcut icon" sizes="196x196">
	<!-- iOS -->
	<link href="./images/icons/apple-touch-icon.png"                      rel="apple-touch-icon" />
	<link href="./images/icons/apple-touch-icon-57x57.png"                rel="apple-touch-icon" sizes="57x57" />
	<link href="./images/icons/apple-touch-icon-72x72.png"                rel="apple-touch-icon" sizes="72x72" />
	<link href="./images/icons/apple-touch-icon-76x76.png"                rel="apple-touch-icon" sizes="76x76" />
	<link href="./images/icons/apple-touch-icon-114x114.png"              rel="apple-touch-icon" sizes="114x114" />
	<link href="./images/icons/apple-touch-icon-114x114-precomposed.png"  rel="apple-touch-icon-precomposed" sizes="114x114" />
	<link href="./images/icons/apple-touch-icon-120x120.png"              rel="apple-touch-icon" sizes="120x120" />
	<link href="./images/icons/apple-touch-icon-144x144.png"              rel="apple-touch-icon" sizes="144x144" />
	<link href="./images/icons/apple-touch-icon-152x152.png"              rel="apple-touch-icon" sizes="152x152" />
	<link href="./images/icons/apple-touch-icon-180x180.png"              rel="apple-touch-icon" sizes="180x180" />
	<link href="./images/icons/icon-hires.png"                            rel="icon" sizes="192x192" />
	<link href="./images/icons/icon-normal.png"                           rel="icon" sizes="128x128" />
	
	<!-- Load Images -->
	<!-- iPhone -->
	<link rel="apple-touch-startup-image"       media="(device-width: 320px)"	href="./images/icons/apple-touch-startup-image-320x460.png">
	<!-- iPhone (Retina) -->
	<link rel="apple-touch-startup-image"		media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" href="./images/icons/apple-touch-startup-image-640x920.png">
	<!-- iPad (portrait) -->
	<link rel="apple-touch-startup-image"       media="(device-width: 768px) and (orientation: portrait)" href="./images/icons/apple-touch-startup-image-768x1004.png">
	<!-- iPad (landscape) -->
	<link rel="apple-touch-startup-image"       media="(device-width: 768px) and (orientation: landscape)" href="./images/icons/apple-touch-startup-image-748x1024.png">
	<!-- iPad (Retina, portrait) -->
	<link rel="apple-touch-startup-image"       media="(device-width: 768px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)"
      href="./images/icons/apple-touch-startup-image-1536x2008.png">
	<!-- iPad (Retina, landscape) -->
	<link rel="apple-touch-startup-image"       media="(device-width: 768px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)"
      href="./images/icons/apple-touch-startup-image-1496x2048.png">  
	
	
	<link rel="stylesheet" href="./css/responsive/structure.css" type="text/css" />
    <script type="text/javascript" src="./lib/jquery-1.4.4.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./lib/weather/jquery.jdigiclock.css" />
	<link rel="stylesheet" href="./html/responsive/w3.css">
	<style>
	.w3-sidebar a {font-family: "Roboto", sans-serif}
	body,h1,h2,h3,h4,h5,h6,.w3-wide {font-family: "Roboto", sans-serif;}
	</style>
    <script type="text/javascript" src="./lib/weather/lib/jquery.jdigiclock.js"></script>
	<!--  <link rel="stylesheet" type="text/css" href="./css/tablet/roboto.all.css" /> -->


<!-- BEGIN: css_specific_file -->
    <link rel="stylesheet" href="{CSU}" type="text/css" />
    <!--  <link rel="stylesheet" href="./css/tablet/{PAGE}.css" type="text/css" />  -->
<!-- END: css_specific_file -->

    {XAJAX}

{FILE {JAVASCRIPT}}

    <script type="text/javascript">

      $(document).ready(function() {
        var iframe = document.createElement("iframe");
        iframe.src = "/smartcan/www/lib/listen.html";
        iframe.style.display = "none";
        document.body.appendChild(iframe);
      });

      function reception(data) {
        tab = data.split(';');
        if ( tab[0] == 'message' ) {
          $('#message').text(tab[1]);
        }
        else {
          if ( window.receptionmodule ) {
            receptionmodule(tab[0], tab[1]);
          }
        }
      }

      function go(contenu) {
        var theme=document.getElementById("usedtheme").value;
        url = '?page=' + contenu;
        if (theme!='') { url = url + '&theme=' + theme; }
        setTimeout("window.location.replace(url)", 100);
      }

      function traitement() {
        $('#traitement').css('display', 'block');
      }
	  function fin_traitement() {
        $('#traitement').css('display', 'none');
      }

    </script>
	
	<script type="text/javascript">
	  idleTime = 0; 
	  
	  $(document).ready(function() {
	  
	  if ('serviceWorker' in navigator) {
		window.addEventListener('load', function() {
			navigator.serviceWorker.register('./service-worker.js').then(function(registration) {
				// Registration was successful
				console.log('PWA: ServiceWorker registration successful with scope: ', registration.scope);
			}, function(err) {
				// registration failed :(
				console.log('PWA: ServiceWorker registration failed: ', err);
			});
		});
	  }
	  window.addEventListener('online', function(e) {
    // Resync data with server.
    console.log("PWA: You are online");
    //Page.hideOfflineWarning();
    //Arrivals.loadData();
}, false);

window.addEventListener('offline', function(e) {
    // Queue up events for server.
    console.log("PWA: You are offline");
    <!-- //Page.showOfflineWarning(); -->
}, false);

// Check if the user is connected.
if (navigator.onLine) {
    //Arrivals.loadData();
} else {
    // Show offline message
    Page.showOfflineWarning();
}

// Set Knockout view model bindings.
//ko.applyBindings(Page.vm);
	  
		var idleInterval = setInterval("timerIncrement()", 100000); // 100 seconde
		$(this).mousemove(function(e) {
		  idleTime = 0;
	    });
		$(this).mousedown(function(e) {
		  idleTime = 0;
	    });
	    $(this).keypress(function(e) {
		  idleTime = 0;
	    });
	  });

	  function timerIncrement() {
		idleTime = idleTime + 1;
		if ((idleTime >= 3) && (document.getElementById("div_sess").getAttribute('data-value'))) {
		  // After 5 Minutes time out (3*100 seconds) ... logout, if session active
		  //alert('Cookie='+document.cookie);
		  //alert('Sess Div='+document.getElementById("div_sess").getAttribute('data-value'));
		  //window.location = '?logout=1';
		}
	  }
	  
	</script>
  </head>

  <body>
    <div style="display: none;" id="div_sess" name="div_sess" data-value="{DIV_SESS}"></div>
    
	
	

<div class="w3-container w3-black" style="position:relative;width=100%">
 <div class="entete">
	<input type="hidden" id="usedtheme" value="{USED_THEME}"/>
        <p>{TITRE}</p>
        <div id="message">
        Pret...
        </div>
 </div>
</div>

<div class="w3-black w3-animate-zoom" style="padding:0px 50px;">

<div class="w3-section w3-row-padding">

  <div class="w3-threequarter w3-black" style="width:550px">
	<div class="corps_gauche">{FILE {content}}</div>
  </div>
  <!-- Large Screen -->
  <div class="w3-quarter w3-container w3-right w3-hide-medium w3-hide-small">
    <div class="corps_droite">
          <table cellpadding="0" cellspacing="0">
            <tr>
              <td class="column1">
                <img src="./images/nl/lights.png" onClick="go('lights');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column3">
                <img src="./images/nl/heater.png" onClick="go('thermostat');" />
              </td>
            </tr>
            <tr>
              <td class="column1">
                <img src="./images/nl/vibes.png" onClick="go('vibes');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column3">
                <img src="./images/nl/weather.png" onClick="go('weather');" />
              </td>
            </tr>
            <tr>
              <td class="column1">
                <img src="./images/nl/surveillance.png" onClick="go('surveillance');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column3">
                <img src="./images/nl/trains.png" onClick="go('trains');" />
              </td>
            </tr>
          </table>
          <span id="traitement" style="font-size: 12px; color: red; font-weight: bold; display: none;">In behandeling...</span>
        </div>
  </div>
  <!-- Small & Medium Screen -->
  <div class="w3-container w3-center w3-hide-large">

      <div class="corps_bas">
          <table cellpadding="0" cellspacing="0">
            <tr>
              <td class="column1">
                <img src="./images/nl/lights.png" onClick="go('lights');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column1">
                <img src="./images/nl/vibes.png" onClick="go('vibes');" />
              </td>			  
              <td class="column2">&nbsp;</td>			  
              <td class="column1">
                <img src="./images/nl/surveillance.png" onClick="go('surveillance');" />
              </td>			  
			</tr>
            <tr>  
              <td class="column3">
                <img src="./images/nl/heater.png" onClick="go('thermostat');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column3">
                <img src="./images/nl/weather.png" onClick="go('weather');" />
              </td>
              <td class="column2">&nbsp;</td>
              <td class="column3">
                <img src="./images/nl/trains.png" onClick="go('trains');" />
              </td>
            </tr>
          </table>
		  <span id="traitement" style="font-size: 12px; color: red; font-weight: bold; display: none;">In behandeling...</span>
      </div>

  </div>
  
</div>

<div id="token"></div>
    <div id="msg"></div>
    <div id="notis"></div>
    <div id="err"></div>
    <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase.js"></script>
    <script>
        MsgElem = document.getElementById("msg");
        TokenElem = document.getElementById("token");
        NotisElem = document.getElementById("notis");
        ErrElem = document.getElementById("err");

		function sendTokenToServer(currentToken) {
			console.log("Sending Token");
			var xhr = new XMLHttpRequest();
			xhr.open("POST", './getToken.php', true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.send(JSON.stringify({
				Token: currentToken
			}));
		}
		
        // Initialize Firebase
        // TODO: Replace with your project's customized code snippet
		var firebaseConfig = {
			apiKey: "AIzaSyDZgiyflnAxIXsWgREIZYNn3FOKLXbUOOw",
			authDomain: "smartcan-58e59.firebaseapp.com",
			databaseURL: "https://smartcan-58e59.firebaseio.com",
			projectId: "smartcan-58e59",
			storageBucket: "smartcan-58e59.appspot.com",
			messagingSenderId: "103123974542",
			appId: "1:103123974542:web:ff7e898a3ec7c3feff4cdf"
		};
        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();
        messaging
            .requestPermission()
            .then(function () {
                //MsgElem.innerHTML = "Notification permission granted." 
                console.log("Notification permission granted.");
                
                // get the token in the form of promise
                return messaging.getToken()
            })
            .then(function(token) {
			  if (token==="") {
			    location.reload();
			  } else {
                //TokenElem.innerHTML = "token is : " + token
				sendTokenToServer(token)
			  }
            })
            .catch(function (err) {
                ErrElem.innerHTML =  ErrElem.innerHTML + "; " + err
                console.log("Unable to get permission to notify.", err);
            });
        messaging.onMessage(function(payload) {
            console.log("Message received. ", payload);
            //NotisElem.innerHTML = NotisElem.innerHTML + JSON.stringify(payload) 
        });
		

    </script>


  </body>
</html>
<!-- END: main -->
